<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // Liste SANS extension (fallback .jpg/.jpeg/.png)
  const FILES = [
    "appel","assis","bol","bonded_trains","cat","chaises","costumes","courant","dame",
    "db","departs","down","echaffaudage","eglise","ensemble","envers","envie_de_violences",
    "fermer","gardien","gens","gouttes","la_ou_ailleurs","la_ronde","les","oliviers",
    "lights","lueurs","man_of_steel","minmaj","monter","mort","murs","nez","nikon",
    "nostalgia","nuages","obey","opera","passants","quinte_flush","racines","rails",
    "regards","rue","skyline","statues","toi","trans","un_chemin_piano_solo","un_chemin",
    "une_priere","vinyle"
  ];

  const grid = document.getElementById('gallery-grid');
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lightbox-img');

  function openLightbox(src){ lbImg.src = src; lb.classList.add('show'); }
  lb.addEventListener('click', () => lb.classList.remove('show'));
  document.addEventListener('keydown', (e)=>{ if(e.key === "Escape") lb.classList.remove('show'); });

  function setSrcWithFallback(img, base){
    const exts = [".jpg",".jpeg",".png"];
    let i = 0;
    function tryNext(){
      if(i >= exts.length){ img.alt += " (introuvable)"; return; }
      img.src = "/assets/visions/" + base + exts[i++];
    }
    img.onerror = tryNext;
    tryNext();
  }

  let currentIndex = 0;
  const batchSize = 12;

  function renderBatch() {
    const slice = FILES.slice(currentIndex, currentIndex + batchSize);
    slice.forEach(base => {
      const fig = document.createElement('figure');
      const img = document.createElement('img');
      img.alt = "Photo noir et blanc â€” " + base;
      img.loading = "lazy";
      img.addEventListener('click', () => openLightbox(img.src));
      setSrcWithFallback(img, base);
      fig.appendChild(img);
      grid.appendChild(fig);
    });
    currentIndex += batchSize;
    const loadBtn = document.getElementById('loadMoreBtn');
    if (currentIndex >= FILES.length && loadBtn) loadBtn.style.display = "none";
  }

  renderBatch();
  document.getElementById('loadMoreBtn')?.addEventListener('click', renderBatch);
</script>
