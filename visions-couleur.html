<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // Liste SANS extension (on gère .jpg/.jpeg/.png en fallback auto)
  const FILES = [
    "bleu","branche","carrefour","concept","concept_double","duo_fandor","elle","escalier","epave","fandorfetedelaville","fandoryt","flous","fa2",
    "fa3","live","medracaster","miroir","nuit","passants","pub","reflet","sapin","scene","sea","seine","seul","soiree","supersonic"
  ];

  const grid = document.getElementById('gallery-grid');
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lightbox-img');

  function openLightbox(src){ lbImg.src = src; lb.classList.add('show'); }
  lb.addEventListener('click', () => lb.classList.remove('show'));
  document.addEventListener('keydown', (e)=>{ if(e.key === "Escape") lb.classList.remove('show'); });

  // Fallback d'extension : .jpg -> .jpeg -> .png
  function setSrcWithFallback(img, base){
    const exts = [".jpg",".jpeg",".png"];
    let i = 0;
    function tryNext(){
      if(i >= exts.length){ img.alt += " (introuvable)"; return; }
      img.src = "/assets/visions/" + base + exts[i++];
    }
    img.onerror = tryNext;
    tryNext();
  }

  // Chargement par lots (Charger plus)
  let currentIndex = 0;
  const batchSize = 12;

  function renderBatch() {
    const slice = FILES.slice(currentIndex, currentIndex + batchSize);
    slice.forEach(base => {
      const fig = document.createElement('figure');
      const img = document.createElement('img');
      img.alt = "Photo couleur — " + base;
      img.loading = "lazy";
      img.addEventListener('click', () => openLightbox(img.src));
      setSrcWithFallback(img, base);
      fig.appendChild(img);
      grid.appendChild(fig);
    });
    currentIndex += batchSize;
    const loadBtn = document.getElementById('loadMoreBtn');
    if (currentIndex >= FILES.length && loadBtn) loadBtn.style.display = "none";
  }

  renderBatch();
  document.getElementById('loadMoreBtn')?.addEventListener('click', renderBatch);
</script>
