<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // NOMS EXACTS (sans extension) — d'après ton dossier
  const FILES = [
    "bleu","branche","carrefour","concept","double","elle","escalier","flous",
    "live","medracaster","miroir","pub","scene","sea","up"
  ];

  const grid = document.getElementById('gallery-grid');
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lightbox-img');
  function openLightbox(src){ lbImg.src = src; lb.classList.add('show'); }
  lb.addEventListener('click', () => lb.classList.remove('show'));
  document.addEventListener('keydown', (e)=>{ if(e.key === "Escape") lb.classList.remove('show'); });

  // Fallback d’extension (.jpg → .jpeg → .png)
  function setSrcWithFallback(img, base){
    const exts = [".jpg",".jpeg",".png"];
    let i = 0;
    function tryNext(){
      if(i >= exts.length){ img.alt += " (introuvable)"; return; }
      img.src = "/assets/visions/" + base + exts[i++];
    }
    img.onerror = tryNext;
    tryNext();
  }

  // Charger plus (12 par lot)
  let currentIndex = 0;
  const batchSize = 12;
  function renderBatch(){
    const slice = FILES.slice(currentIndex, currentIndex + batchSize);
    slice.forEach(base => {
      const fig = document.createElement('figure');
      const img = document.createElement('img');
      img.alt = "Photo couleur — " + base;
      img.loading = "lazy";
      img.addEventListener('click', () => openLightbox(img.src));
      setSrcWithFallback(img, base);
      fig.appendChild(img);
      grid.appendChild(fig);
    });
    currentIndex += batchSize;
    const loadBtn = document.getElementById('loadMoreBtn');
    if (currentIndex >= FILES.length && loadBtn) loadBtn.style.display = "none";
  }
  renderBatch();
  document.getElementById('loadMoreBtn')?.addEventListener('click', renderBatch);
</script>
